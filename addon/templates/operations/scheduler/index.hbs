<Layout::Section::Header @title={{t "menu.scheduler"}}>
    <div class="flex items-center gap-2">
        <Button
            @type={{if (eq this.viewMode "orders") "primary" "default"}}
            @text="Orders"
            @icon="box"
            @onClick={{fn this.switchViewMode "orders"}}
            @size="sm"
        />
        <Button
            @type={{if (eq this.viewMode "drivers") "primary" "default"}}
            @text="Driver Schedules"
            @icon="id-card"
            @onClick={{fn this.switchViewMode "drivers"}}
            @size="sm"
        />
        {{#if (eq this.viewMode "drivers")}}
            <Button
                @type="success"
                @text="Add Shift"
                @icon="plus"
                @onClick={{this.addDriverShift}}
                @size="sm"
            />
        {{/if}}
    </div>
</Layout::Section::Header>

<Layout::Section::Body>
    <div id="fleet-ops-scheduler-container">
        <div class="grid grid-cols-1 lg:grid-cols-3">
            <div id="fleet-ops-scheduler-sidebar" class="scheduler-left-sidebar">
                <ContentPanel
                    @title={{t "scheduler.unscheduled-orders"}}
                    @titleStatuRight={{this.unscheduledOrders.length}}
                    @titleStatuRightClass="info-status-badge"
                    @hideStatusDot={{true}}
                    @open={{this.unscheduledOrders.length}}
                    @wrapperClass="bordered-top"
                >
                    <div class="space-y-2">
                        {{#each this.unscheduledOrders as |order|}}
                            <FullCalendar::Draggable @eventData={{json-hash id=order.id title=order.eventTitle allDay=true}} @disabled={{cannot "fleet-ops update order"}}>
                                <Order::ScheduleCard @order={{order}} @titleClass="cursor-move" @onTitleClick={{fn this.viewEvent order}} />
                            </FullCalendar::Draggable>
                        {{/each}}
                    </div>
                </ContentPanel>
                <ContentPanel
                    @title={{t "scheduler.scheduled-orders"}}
                    @titleStatuRight={{this.scheduledOrders.length}}
                    @titleStatusRightClass="info-status-badge"
                    @hideStatusDot={{true}}
                    @open={{this.scheduledOrders.length}}
                    @wrapperClass="bordered-top"
                >
                    <div class="space-y-2">
                        {{#each this.scheduledOrders as |order|}}
                            <Order::ScheduleCard @order={{order}} @titleClass="cursor-pointer" @onTitleClick={{fn this.viewEvent order}} />
                        {{/each}}
                    </div>
                </ContentPanel>
                <Spacer @height="200px" />
            </div>

            <div id="fleet-ops-scheduler-calendar" class="col-span-2 py-4 px-2">
                {{#if (cannot "fleet-ops update order")}}
                    <div class="flex flex-row items-center text-xs bg-yellow-800 border border-yellow-600 px-2 py-2 rounded-md text-yellow-100 mb-4 space-x-2">
                        <FaIcon @icon="triangle-exclamation" @size="sm" />
                        <div class="flex-1">
                            {{t "scheduler.unauthorized-to-schedule"}}
                        </div>
                    </div>
                {{/if}}
                {{#if (eq this.viewMode "drivers")}}
                    <FullCalendar
                        @events={{this.events}}
                        @resources={{this.calendarResources}}
                        @editable={{true}}
                        @onEventDrop={{this.rescheduleEventFromDrag}}
                        @onEventClick={{this.viewOrderAsEvent}}
                        @onInit={{this.setCalendarApi}}
                        @schedulerLicenseKey="GPL-My-Project-Is-Open-Source"
                    />
                {{else}}
                    <FullCalendar
                        @events={{this.events}}
                        @editable={{true}}
                        @onDrop={{this.scheduleEventFromDrop}}
                        @onEventReceive={{this.receivedEvent}}
                        @onEventDrop={{this.rescheduleEventFromDrag}}
                        @onEventClick={{this.viewOrderAsEvent}}
                        @onInit={{this.setCalendarApi}}
                    />
                {{/if}}
                <Spacer @height="200px" />
            </div>
        </div>
    </div>
</Layout::Section::Body>