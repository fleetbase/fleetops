<MapContainer::Topbar class="next-topbar-{{this.layout}}">
    <MapContainer::ViewSwitch>
        <FaIcon @icon="layer-group" class="mr-2 text-gray-400 dark:text-gray-600" />
        <button type="button" id="ops-map-view-button" class="{{if this.isMapLayout 'active'}}" {{on "click" (fn this.setLayoutMode "map")}}>{{t
                "fleet-ops.operations.orders.index.map"
            }}</button>
        <button type="button" id="ops-table-view-button" class="{{if this.isTableLayout 'active'}} flex flex-row items-center relative" {{on "click" (fn this.setLayoutMode "table")}}>
            <div class="mr-1.5">{{t "fleet-ops.operations.orders.index.table"}}</div>
            <Badge
                class="flex items-center justify-center -mr-4"
                @spanClass="rounded-full items-center justify-center h-5 w-7"
                @hideStatusDot={{true}}
                @status="info"
            >{{@model.meta.total}}</Badge>
        </button>
        {{!-- <button type="button" id="ops-kanban-view-button" class="{{if this.isKanbanView 'active'}}" {{on "click" (fn this.setLayoutMode "kanban")}}>Board</button> --}}
    </MapContainer::ViewSwitch>
</MapContainer::Topbar>

{{#if this.isMapLayout}}
    <MapContainer @layout={{this.layout}} @onReady={{this.onMapContainerReady}}>
        <GlobalSearch @visible={{this.isSearchVisible}} @onPressOrder={{this.viewOrder}} />
        <MapContainer::Toolbar
            @activeOrdersCount={{this.activeOrdersCount}}
            @map={{this.leafletMap}}
            @onPressViewOrders={{this.toggleOrdersPanel}}
            @onPressSearch={{this.toggleSearch}}
            @onPressCreateOrder={{this.createOrder}}
            @onPressLiveMapDrawerToggle={{this.onPressLiveMapDrawerToggle}}
        />
        <OrderListOverlay
            @isOpen={{false}}
            @noBackdrop={{true}}
            @fullHeight={{true}}
            @width={{if (media "isMobile") "100%" "338px"}}
            @onLoad={{this.setOrderListOverlayContext}}
            @onPressCancel={{this.hideOrdersPanel}}
            @onPressCreateOrder={{this.createOrder}}
            @onPressViewOrder={{this.viewOrder}}
            @onPressCreateFleet={{this.fleetController.createFleet}}
            @onPressManageFleet={{this.fleetController.viewFleet}}
            @onPressCancelOrders={{this.bulkCancelOrders}}
            @onPressDeleteOrders={{this.bulkDeleteOrders}}
            @onMouseEnterOrder={{this.previewOrderRoute}}
            @onMouseLeaveOrder={{this.restoreDefaultLiveMap}}
        />
        <LiveMap
            id="leafletMap"
            class="next-leaflet-container-map"
            @lat={{1.3521}}
            @lng={{103.8198}}
            @zoom={{12}}
            @zoomControl={{false}}
            @onLoad={{this.setMapReference}}
            @onDrawerReady={{this.setDrawerContext}}
            @isDrawerMinimized={{not this.drawerOpen}}
            @onDrawerResizeEnd={{this.onDrawerResizeEnd}}
            @onDrawerTabChanged={{this.onDrawerTabChanged}}
            @drawerTab={{this.drawerTab}}
            @darkMode={{eq this.theme.activeTheme "dark"}}
            {{set-container-dimensions}}
        />
    </MapContainer>
{{/if}}

{{#if this.isTableLayout}}
    <Layout::Resource::Tabular
        @resource="order"
        @title={{t "fleet-ops.common.orders"}}
        @searchQuery={{this.query}}
        @onSearch={{perform this.orderActions.controllerSearchTask this}}
        @bulkSearchValue={{this.bulk_query}}
        @onClearBulkSearch={{fn (mut this.bulk_query)}}
        @onSubmitBulkSearch={{fn (mut this.bulk_query)}}
        @bulkSearchPlaceholder="Input comma delimited order ID's or tracking numbers to perform a bulk search"
        @data={{@model}}
        @columns={{this.columns}}
        @page={{this.page}}
        @onPageChange={{fn (mut this.page)}}
        @setupTable={{fn (mut this.table)}}
        @actionButtons={{this.actionButtons}}
        @bulkActions={{this.bulkActions}}
        @filterPickerGridCols="3"
        @filterPickerWidth="700px"
        @controller={{this}}
        @tfootVerticalOffset="7"
        @tfootVerticalOffsetElements="#next-view-section-subheader,.next-table-wrapper > table > thead,.next-map-container-topbar"
    />
{{/if}}

{{#if this.isKanbanView}}
    <Layout::Section::Header @title={{t "fleet-ops.common.orders"}} @onSearch={{perform this.search}}>
        <Button @icon="cogs" @text={{t "fleet-ops.common.config"}} class="mr-2" @onClick={{fn (transition-to "operations.orders.index.config")}} />
        <FiltersPicker
            @columns={{this.columns}}
            @onApply={{fn this.filters.apply this}}
            @onClear={{fn this.filters.reset this}}
            @onFilterClear={{this.filters.clear}}
            @onChange={{this.filters.set}}
            @buttonWrapperClass="mr-2"
        />
        <Button @type="primary" @icon="plus" @iconPrefix="fas" @text={{t "fleet-ops.common.new"}} @wrapperClass="mr-2" @onClick={{fn (transition-to "operations.orders.index.new")}} />
        <Button @icon="long-arrow-up" @iconClass="rotate-icon-45" @text={{t "fleet-ops.common.export"}} @onClick={{this.exportOrders}} />
    </Layout::Section::Header>
    <Layout::Section::Body>
        <OrderBoard @type={{this.type}} />
    </Layout::Section::Body>
{{/if}}

{{outlet}}